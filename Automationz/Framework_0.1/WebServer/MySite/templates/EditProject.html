{%extends 'AdminBaseTemplate.html'%}
{%block pageindicator%}Edit Project{%endblock%}
{%block title%}Edit Project{%endblock%}
{% block content%}
<div align="right">
    <input type="button" value="Manage Team" id="manage_team" class="m-btn blue"/>
    <input type="button" value="Setup Email" id="setup_email" style="margin-right: 2%;" class="m-btn green"/>
</div>
<div class="responsive-tabs" style="margin-left: 30px">
        <h2>Detail</h2>
        <div class="tabs-div" align="left" style="margin-top: 30px;margin-left: 10%">
            <table class="two-column-emphasis">
            <tr>
                <td><b>Name:</b></td>
                <td><input class="textbox" value="{{project_name}}" id="project_name"/></td>
            </tr>
            <tr>
                <td><b>Starting Date:</b></td>
                <td><input class="textbox"  {% if project_startingdate == ''%}placeholder="Starting date is not set"{% endif %} id="starting_date"/></td>
            </tr>
            <tr>
                <td><b>Ending Date:</b></td>
                <td><input class="textbox" {% if project_endingdate == ''%}placeholder="Ending date is not set"{% endif %} id="ending_date"/></td>
            </tr>
            <tr>
                <td style="vertical-align: 0%;"><b>Description:</b></td>
                <td><textarea id="project_description" rows="3" cols="47" {% if project_description == ''%}placeholder="No Description is set"{% endif %}>{{project_description}}</textarea></td>
            </tr>

            <tr>
                <td><b>Owners:</b></td>
                <td><input  type="hidden" id="project_owners"/></td>
            </tr>
            <tr>
                <td>&nbsp;</td>
                <td>
                    <table id="owner_list">
                        {% for x in project_owners%}
                            <tr><td data-id="{{x.0}}"><img class="delete" title = "Delete" src="/site_media/delete4.png" style="width: 30px; height: 30px"/>{{x.1}}</td></tr>
                        {% endfor %}
                    </table>
                </td>
            </tr>
            <!--tr>
                <td>&nbsp;</td>
                <td><input  type="button" class="m-btn green" id="edit_button" value="Edit"/></td>
            </tr-->
        </table>
        </div>

        <h2>Related Items</h2>
        <div class="tabs-div" align="left" style="margin-top: 30px;margin-left: 10%">
            <table class="two-column-emphasis">
            <tr>
                <td><b>Server:</b></td>
                <td><input class="textbox" value="{{server}}" id="server"/></td>
            </tr>
            <tr>
                <td><b>Hyperlink:</b></td>
                <td><input class="textbox" type="url" value="{{hyperlink}}" id="hyperlink"/></td>
            </tr>
            <tr>
                <td><b>Username:</b></td>
                <td><input class="textbox" value="{{username}}" id="username"/></td>
            </tr>
            <tr>
                <td><b>Password:</b></td>
                <td><input class="textbox" type="password" value="{{password}}" id="password"/></td>
            </tr>
            <tr>
                <td><b>Application:</b></td>
                <td><!--input class="textbox" value="" id="application"/-->
                    <table><tr>
                                <td>
                                <input id="github" class="cmn-toggle cmn-toggle-yes-no" type="radio" name="application" value="github" {% if application == "github"%}checked="checked"{% endif %}>
                                <label for="github" data-on="Github" data-off="Github"></label>
                                </td><td>
                                <input id="jira" class="cmn-toggle cmn-toggle-yes-no" type="radio" name="application" value="jira" {% if application == "jira"%}checked="checked"{% endif %}>
                                <label for="jira" data-on="JIRA" data-off="JIRA"></label>
                                </td>
                                <td>
                                <input id="rally" class="cmn-toggle cmn-toggle-yes-no" type="radio" name="application" value="rally" {% if application == "rally"%}checked="checked"{% endif %}>
                                <label for="rally" data-on="Rally" data-off="Rally"></label>
                                </td></tr></table>
                </td>
            </tr>
        </table>
        </div>

</div>

<div align="center"><input  type="button" class="m-btn green" id="edit_button" value="Edit"/></div>




<script type="text/javascript">
    $('#manage_team').on('click',function(){
       window.location='/Home/{{project_id}}/ManageTeam/';
    });
    $('#setup_email').on('click',function(){
       window.location='/Home/{{project_id}}/SetupEmail/';
    });
    $('#project_owners').select2({placeholder: "Search User....",
        width: 460,
        quietMillis: 250,
        ajax: {
            url: "GetProjectOwner",
            dataType: "json",
            queitMillis: 250,
            data: function(term, page) {
                return {
                    'term': term,
                    'page': page,
                    'tag':'edit'
                };
            },
            results: function(data, page) {
                return {
                    results: data.items,
                    more: data.more
                }
            }
        },
        formatResult: formatTestCasesSearch
    }).on("change", function(e) {
                var user_id=$(this).select2('data')['id'];
                var user_name=$(this).select2('data')['text'].split(' - ')[0].trim();
                $('#owner_list').append('<tr><td data-id="'+user_id+'"><img class="delete" title = "Delete" src="/site_media/delete4.png" style="width: 30px; height: 30px"/>'+user_name+'</td></tr>');
                $('.delete').on('click',function(){
                    $(this).parent().parent().remove();
                });
                $(this).select2('val','');
                return false;
            });
    function formatTestCasesSearch(test_case_details) {
        var markup ='<div><i class="fa fa-user-o"></i><span style="font-weight: bold;"><span>' + test_case_details.text + '</span></div>';
        return markup;
    };
    $('.delete').on('click',function(){
        $(this).parent().parent().remove();
    });
    $('#starting_date').datepicker({dateFormat:"MM d, yy"});
    $('#ending_date').datepicker({dateFormat:"MM d, yy"});
    if("{{project_startingdate}}"!=''){
        $('#starting_date').datepicker('setDate', new Date("{{project_startingdate}}"));
    }
    if("{{project_endingdate}}"!=''){
        $('#ending_date').datepicker('setDate', new Date("{{project_endingdate}}"));
    }
    $('#edit_button').on('click',function(){
        var project_name=$('#project_name').val();
        var starting_date=$('#starting_date').val();
        var ending_date=$('#ending_date').val();
        var project_description=$('#project_description').val();
        var owner_list=[];
        $('#owner_list tr').each(function(){
            var user_id=$(this).find('td:first-child').attr('data-id');
            if(owner_list.indexOf(user_id)==-1){
                owner_list.push(user_id);
            }
        });
        if(project_name==''){
            alertify.set({ delay: 300000 });
            alertify.error('Project Name is empty');
            return false;
        }
        if(owner_list.length==0){
            alertify.set({ delay: 300000 });
            alertify.error('No Owner is selected');
            return false;
        }
        $.get('Edit_Project',{
            'project_id':"{{project_id}}",
            'project_name':project_name,
            'starting_date':starting_date,
            'ending_date':ending_date,
            'description':project_description,
            'owner_list':owner_list.join(","),
            'user': $.session.get('fullname'),
            'server':$("#server").val(),
            'hyperlink':$("#hyperlink").val(),
            'username':$("#username").val(),
            'password':$("#password").val(),
            'application':$('input[name="application"]:checked').val()
        },function(data){
            if(data){
                alertify.set({ delay: 300000 });
                alertify.success('Project Updated Successfully');
                window.location.reload(true);
            }
            else{
                alertify.set({ delay: 300000 });
                alertify.error("Project not updated");
                window.location.reload(false);
            }
        });
    });
</script>


<script>
        // ResponsiveTabs.js | Version:1.10 | Author:Pete Love | www.petelove.com
        var RESPONSIVEUI={};(function($){RESPONSIVEUI.responsiveTabs=function(){var $tabSets=$(".responsive-tabs");if(!$tabSets.hasClass("responsive-tabs--enabled")){$tabSets.addClass("responsive-tabs--enabled");var tablistcount=1;$tabSets.each(function(){var $tabs=$(this);$tabs.children(":header").addClass("responsive-tabs__heading");$tabs.children("div").addClass("responsive-tabs__panel");var $activePanel=$tabs.find(".responsive-tabs__panel--active");if(!$activePanel.length){$activePanel=$tabs.find(".responsive-tabs__panel").first().addClass("responsive-tabs__panel--active")}$tabs.find(".responsive-tabs__panel").not(".responsive-tabs__panel--active").hide().attr("aria-hidden","true");$activePanel.attr("aria-hidden","false");$activePanel.addClass("responsive-tabs__panel--closed-accordion-only");var $tabsWrapper=$("<div/>",{"class":"responsive-tabs-wrapper"});$tabs.wrap($tabsWrapper);var highestHeight=0;$tabs.find(".responsive-tabs__panel").each(function(){var tabHeight=$(this).height();if(tabHeight>highestHeight){highestHeight=tabHeight}});var $tabList=$("<ul/>",{"class":"responsive-tabs__list",role:"tablist"});var tabcount=1;$tabs.find(".responsive-tabs__heading").each(function(){var $tabHeading=$(this);var $tabPanel=$(this).next();$tabHeading.attr("tabindex",0);var $tabListItem=$("<li/>",{"class":"responsive-tabs__list__item",id:"tablist"+tablistcount+"-tab"+tabcount,"aria-controls":"tablist"+tablistcount+"-panel"+tabcount,role:"tab",tabindex:0,text:$tabHeading.text(),keydown:function(objEvent){if(objEvent.keyCode===13){$tabListItem.click()}},click:function(){$tabsWrapper.css("height",highestHeight);$tabs.find(".responsive-tabs__panel--closed-accordion-only").removeClass("responsive-tabs__panel--closed-accordion-only");$tabs.find(".responsive-tabs__panel--active").toggle().removeClass("responsive-tabs__panel--active").attr("aria-hidden","true").prev().removeClass("responsive-tabs__heading--active");$tabPanel.toggle().addClass("responsive-tabs__panel--active").attr("aria-hidden","false");$tabHeading.addClass("responsive-tabs__heading--active");$tabList.find(".responsive-tabs__list__item--active").removeClass("responsive-tabs__list__item--active");$tabListItem.addClass("responsive-tabs__list__item--active");$tabsWrapper.css("height","auto")}});$tabPanel.attr({role:"tabpanel","aria-labelledby":$tabListItem.attr("id"),id:"tablist"+tablistcount+"-panel"+tabcount});if($tabPanel.hasClass("responsive-tabs__panel--active")){$tabListItem.addClass("responsive-tabs__list__item--active")}$tabList.append($tabListItem);$tabHeading.keydown(function(objEvent){if(objEvent.keyCode===13){$tabHeading.click()}});$tabHeading.click(function(){$tabs.find(".responsive-tabs__panel--closed-accordion-only").removeClass("responsive-tabs__panel--closed-accordion-only");if(!$tabHeading.hasClass("responsive-tabs__heading--active")){var oldActivePos,$activeHeading=$tabs.find(".responsive-tabs__heading--active");if($activeHeading.length){oldActivePos=$activeHeading.offset().top}$tabs.find(".responsive-tabs__panel--active").slideToggle().removeClass("responsive-tabs__panel--active").prev().removeClass("responsive-tabs__heading--active");$tabs.find(".responsive-tabs__panel").hide().attr("aria-hidden","true");$tabPanel.slideToggle().addClass("responsive-tabs__panel--active").attr("aria-hidden","false");$tabHeading.addClass("responsive-tabs__heading--active");var $currentActive=$tabs.find(".responsive-tabs__list__item--active");$currentActive.removeClass("responsive-tabs__list__item--active");var panelId=$tabPanel.attr("id");var tabId=panelId.replace("panel","tab");$("#"+tabId).addClass("responsive-tabs__list__item--active");var tabsPos=$tabs.offset().top;var newActivePos=($tabHeading.offset().top)-15;if(oldActivePos<newActivePos){$("html, body").animate({scrollTop:tabsPos},0).animate({scrollTop:newActivePos},400)}}else{$tabPanel.removeClass("responsive-tabs__panel--active").slideToggle(function(){$(this).addClass("responsive-tabs__panel--closed-accordion-only")});$tabHeading.removeClass("responsive-tabs__heading--active")}});tabcount++});$tabs.prepend($tabList);tablistcount++})}}})(jQuery);
    </script>

    <script>
        $(document).ready(function() {
            RESPONSIVEUI.responsiveTabs();

        });
    </script>


{% endblock %}